= Dashboards

En esta página, exploraremos diferentes plataformas y herramientas para la visualización y gestión de datos de dispositivos IoT, incluyendo una guía para integrar datos de un ESP32 con Grafana.

== ThingsBoard

ThingsBoard es una plataforma IoT open-source que facilita la gestión de dispositivos, así como la recolección, procesamiento y visualización de datos.

Sus funcionalidades clave incluyen:

*   Un motor de reglas flexible para el procesamiento de datos complejos.
*   Dashboards IoT en tiempo real y dashboards SCADA para entornos industriales.
*   Capacidades robustas de aprovisionamiento y monitoreo de entidades IoT.

Más información en el https://github.com/thingsboard/thingsboard[repositorio de GitHub de ThingsBoard].

== OpenRemote

OpenRemote es una plataforma IoT de código abierto e intuitiva, diseñada para construir soluciones completas de gestión de dispositivos. Ofrece un control más granular para equipos internos en comparación con plataformas como ThingsBoard.

Características destacadas de OpenRemote:

*   Aprovisionamiento automático de dispositivos.
*   Personalización de tipos de activos.
*   Automatización avanzada mediante reglas "cuando-entonces", flujos y scripts en JavaScript.
*   Herramientas de análisis de datos.
*   Conectividad a través de múltiples protocolos.
*   Gestión de usuarios y roles.

Más información en el https://github.com/openremote/openremote[repositorio de GitHub de OpenRemote].

== Grafana

Grafana es una herramienta de código abierto popular para la visualización de datos analíticos. En la siguiente sección mostraremos cómo usarla para visualizar datos de temperatura y humedad de un ESP32.

=== Integración con ESP32 (mediante HTTP y SQLite)

Utilizaremos el programa de servidor HTTP para ESP32 (DHT11) que se explicó en la página xref:tools:home-assistant.adoc[Home Assistant].

Crea el siguiente script en Elixir (por ejemplo, `grafana.exs`). Este script se conectará periódicamente al servidor HTTP del ESP32, extraerá las lecturas de temperatura y humedad, y las almacenará en una base de datos SQLite (`main.db`).

[source, elixir]
----
Mix.install([:req, :exqlite])

defmodule Grafana do
  def loop(conn) do
    case Req.get!("http://192.168.1.10:8080/temp") do
      %{body: %{"humidity" => humidity_string, "temperature" => temperature_string}} ->
        {humidity, _} = Float.parse(humidity_string)
        {temperature, _} = Float.parse(temperature_string)

        {:ok, statement} =
          Exqlite.Sqlite3.prepare(
            conn,
            "insert into readings (humidity, temperature, time) values (?1, ?2, ?3)"
          )

        :ok = Exqlite.Sqlite3.bind(statement, [humidity, temperature, System.os_time(:second)])
        :done = Exqlite.Sqlite3.step(conn, statement)

        IO.inspect(humidity, label: "humidity")
        IO.inspect(temperature, label: "temperature")

      _ ->
        nil
    end

    Process.sleep(5000)
    Grafana.loop(conn)
  end
end

{:ok, conn} = Exqlite.Sqlite3.open("file:main.db")

:ok =
  Exqlite.Sqlite3.execute(
    conn,
    "create table if not exists readings (id integer primary key, humidity real, temperature real, time integer)"
  )

Grafana.loop(conn)
----

[NOTE]
====
Reemplaza `"192.168.1.10"` en el código del ESP32 con la dirección IP real del ESP32.
====

Desde la terminal, en el directorio donde guardaste `grafana.exs`, corre el script con `elixir grafana.exs`. Este comando iniciará el proceso de recolección y almacenamiento de datos en `main.db`.

Luego, sigue estos pasos para visualizar los datos en Grafana:

1.  Instala el plugin de SQLite: En `Search` -> `Plugins`, busca e instala el plugin `SQLite`.
2.  Crea una nueva fuente de datos (Data Source): En Grafana, ve a `Connections` -> `Data Sources` y añade una nueva fuente de datos de tipo `SQLite`.
3.  Configura la ruta del archivo: Especifica la ruta completa al archivo `main.db` que el script Elixir está creando (por ejemplo, `/home/user/grafana/main.db`).
4.  Crea un Dashboard y Panel:
    *   Crea un nuevo dashboard y añade un panel de visualización.
    *   En la configuración del panel, selecciona tu fuente de datos SQLite recién creada.
    *   Utiliza la siguiente consulta SQL para obtener la temperatura y humedad a lo largo del tiempo:

[source, sql]
----
SELECT
  time,
  temperature AS "Temperature",
  humidity AS "Humidity"
FROM readings
ORDER BY time
----

image::grafana_dashboard.png[Ejemplo de Dashboard de Grafana con datos del DHT11]
