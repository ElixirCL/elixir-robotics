<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Home Assistant :: Electrónica, Robótica e IOT con Elixir</title>
    <link rel="canonical" href="https://elixircl.github.io/elixir-robotics/tools/home-assistant.html">
    <link rel="prev" href="platformio.html">
    <link rel="next" href="dashboards.html">
    <meta name="generator" content="Antora 3.1.14">
    <link rel="stylesheet" href="../_/css/site.css">
    <link rel="stylesheet" href="../_/js/vendor/styles/monokai.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://elixircl.github.io/elixir-robotics">Electrónica, Robótica e IOT con Elixir</a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Buscar en documentos">
        </div>
      </div>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <!--
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
    -->
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ROOT" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../index.html">Electrónica, Robótica e IOT con Elixir</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Fundamentos e Historia</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../fundamentals/history.html">Historia de la Robótica y Automatización</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../fundamentals/introduction.html">Introducción a la Electrónica</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../fundamentals/electricity.html">Fundamentos de Electricidad</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../fundamentals/programming.html">Lenguajes de Programación</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">IC y Controladores</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../controllers/ic555.html">IC555</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../controllers/pic16f877a.html">PIC16F877a</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../controllers/basicstamp.html">Parallax Basic Stamp</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../controllers/arduino.html">Arduino</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../controllers/raspberry.html">Raspberry Pi</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../controllers/esp32.html">ESP32</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../controllers/stm32.html">STM32</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../controllers/jetson.html">Nvidia Jetson &amp; AMD Kria</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../controllers/fpga.html">FPGA</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Protocolos de Comunicación</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../communication/iot.html">IOT</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Herramientas</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="platformio.html">PlatformIO IDE</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="home-assistant.html">Home Assistant</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="dashboards.html">Dashboards</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="cad.html">Herramientas de Computer Asisted Design (CAD)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="stores.html">Tiendas</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">AtomVM</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../atomvm/atomvm.html">AtomVM</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../atomvm/popcorn.html">Elixir PopCorn</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../atomvm/devenv.html">Entorno de Desarrollo</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../atomvm/components.html">Componentes Electrónicos</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../atomvm/remote.html">Conexión Remota</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../atomvm/colosseo.html">Coliseo Atómico</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../atomvm/arcade.html">Proyecto: Videojuego Arcade</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../atomvm/tagboard.html">Proyecto: Tagboard</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Hardware Avanzado</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../advanced/nerves.html">Nerves</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../advanced/circuits.html">circuits.adoc</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../advanced/soleil.html">soleil.adoc</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../advanced/beambots.html">BeamBots</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../advanced/grisp.html">Grisp</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Energía Solar</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../solar/solar.html">Energía Solar</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Electrónica, Robótica e IOT con Elixir</span>
    <span class="version"></span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="../index.html">Electrónica, Robótica e IOT con Elixir</a></div>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Electrónica, Robótica e IOT con Elixir</a></li>
    <li>Herramientas</li>
    <li><a href="home-assistant.html">Home Assistant</a></li>
  </ul>
</nav>
<div class="edit-this-page"><a href="file:///antora/./modules/tools/pages/home-assistant.adoc">Editar esta página</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contenidos" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Home Assistant</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Home Assistant es un software de automatización del hogar de código abierto que prioriza el control local y la privacidad. Puede ejecutarse en entornos como una Raspberry Pi o en un servidor local, ofreciendo integración con una amplia variedad de plataformas y dispositivos, y se gestiona a través de un dashboard web o una aplicación móvil.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuración-de-un-servidor-autoalojado"><a class="anchor" href="#configuración-de-un-servidor-autoalojado"></a>Configuración de un servidor autoalojado</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Existen dos tipos principales de instalación de Home Assistant: Home Assistant Operating System y Home Assistant Container.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Home Assistant Operating System</strong>: Consiste en un sistema operativo minimalista diseñado específicamente para ejecutar Home Assistant en dispositivos embebidos. A diferencia de la versión en contenedor, soporta add-ons.</p>
</li>
<li>
<p><strong>Home Assistant Container</strong>: Es una instalación basada en un contenedor Docker. Requiere ejecutarse sobre un sistema operativo existente (como Linux) con un motor de orquestación de contenedores (como Docker), y demanda que las actualizaciones y el mantenimiento se realicen manualmente.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Para obtener más detalles, visita la <a href="https://www.home-assistant.io/installation">página de instalación oficial</a>.</p>
</div>
<div class="sect2">
<h3 id="home-assistant-container"><a class="anchor" href="#home-assistant-container"></a>Home Assistant Container</h3>
<div class="paragraph">
<p>La instalación mediante contenedor es la opción más sencilla para integrar Home Assistant en un sistema ya existente. Para ejecutar el contenedor, solo necesitas tener Docker instalado y ejecutar el siguiente comando:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker run -d \
      --name homeassistant \
      --privileged \
      --restart=unless-stopped \
      -e TZ=America/Santiago \
      -v ~/services/home-assistant:/config \
      -v /run/dbus:/run/dbus:ro \
      --network=host \
      ghcr.io/home-assistant/home-assistant:stable</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Deberás modificar la opción <code>-v ~/services/home-assistant:/config</code> para especificar el directorio donde deseas almacenar la configuración de Home Assistant en tu sistema host.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Una vez que el contenedor haya finalizado su descarga y arranque, podrás acceder al dashboard web visitando <code><a href="http://localhost:8123" class="bare">http://localhost:8123</a></code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conexión-de-dispositivos-a-home-assistant"><a class="anchor" href="#conexión-de-dispositivos-a-home-assistant"></a>Conexión de dispositivos a Home Assistant</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Para añadir un dispositivo a través de la interfaz de usuario de Home Assistant, navega hasta el dashboard, haz clic en el icono <strong>+</strong> en la esquina superior derecha y selecciona "Agregar dispositivo". Esto abrirá una ventana con los dispositivos e integraciones compatibles.</p>
</div>
<div class="paragraph">
<p>Además del soporte para dispositivos específicos, Home Assistant incluye integraciones para protocolos como MQTT (también configurables desde la UI). Las APIs REST, por otro lado, requieren configuración manual directamente en el archivo <code>configuration.yaml</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="esp32-con-home-assistant"><a class="anchor" href="#esp32-con-home-assistant"></a>ESP32 con Home Assistant</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Las placas ESP32 son ideales para su uso con Home Assistant, gracias a su tamaño compacto, opciones de conectividad versátiles (Wi-Fi, Bluetooth) y bajo consumo energético. Existen diversas soluciones para conectar un ESP32 con Home Assistant. A continuación, exploraremos dos alternativas.</p>
</div>
<div class="sect2">
<h3 id="esphome"><a class="anchor" href="#esphome"></a>ESPHome</h3>
<div class="paragraph">
<p>ESPHome es un framework de firmware de código abierto diseñado para una integración fluida y profunda con Home Assistant. Su configuración se realiza mediante archivos <code>YAML</code>, donde se declaran los sensores, actuadores y otros periféricos conectados a la placa.</p>
</div>
<div class="paragraph">
<p>Por ejemplo, para configurar un interruptor y un sensor binario:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">switch:
  - platform: gpio
    name: "Living Room Dehumidifier"
    pin: GPIO5

binary_sensor:
  - platform: gpio
    name: "Living Room Window"
    pin:
      number: GPIO0
      inverted: true
      mode:
        input: true
        pullup: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Este enfoque permite configurar fácilmente un dispositivo ESP32 que interactúe de forma nativa con Home Assistant.</p>
</div>
<div class="paragraph">
<p>Más información en la <a href="https://esphome.io/">página oficial de ESPHome</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="atomvm-en-esp32"><a class="anchor" href="#atomvm-en-esp32"></a>AtomVM en ESP32</h3>
<div class="paragraph">
<p>Para casos más especializados o cuando se requiere un control de bajo nivel sobre el firmware, es posible desarrollar programas directamente en el entorno ESP-IDF, utilizando plataformas como AtomVM. Esto permite utilizar diversos protocolos de comunicación compatibles con Home Assistant, ofreciendo gran flexibilidad según el caso de uso. Entre estos métodos, se incluyen webhooks, MQTT o servidores HTTP para polling de datos.</p>
</div>
</div>
<div class="sect2">
<h3 id="rest"><a class="anchor" href="#rest"></a>REST</h3>
<div class="paragraph">
<p>El siguiente ejemplo ilustra la creación de un servidor REST simple en Elixir (AtomVM) que acepta solicitudes GET desde Home Assistant para proporcionar información de temperatura y humedad, utilizando un sensor DHT11.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-elixir hljs" data-lang="elixir">defmodule HomeAssistantTemp do
  @behaviour :httpd_api_handler
  @port 8080

  @dht_pin 21

  def start() do
    {:ok, dht} = :dht.start(%{pin: @dht_pin, device: :dht_11})

    setup_network()

    Process.sleep(3000)

    httpd_config = [
      {[],
       %{
         handler: :httpd_api_handler,
         handler_config: %{
           module: __MODULE__,
           args: dht
         }
       }}
    ]

    {:ok, _httpd_pid} = :httpd.start_link(@port, httpd_config)

    Process.sleep(:infinity)
  end

  def handle_api_request(:get, [&lt;&lt;"temp"&gt;&gt;], http_request, dht) do
    case take_reading(dht) do
      :error -&gt; {:close, %{status: "error"}}
      json -&gt; {:close, json}
    end
  end

  defp take_reading(dht) do
    case :dht.take_reading(dht) do
      {:ok, {{temp, temp_fractional}, {hum, hum_fractional}}} -&gt;
        temperature =
          :io_lib.format('~p.~pC', [temp, temp_fractional])
          |&gt; :lists.flatten()

        humidity =
          :io_lib.format('~p.~p%', [hum, hum_fractional])
          |&gt; :lists.flatten()

        %{temperature: temperature, humidity: humidity}

      error -&gt;
        :io.format('Error taking reading: ~p~n', [error])
        :error
    end
  end

  defp setup_network() do
    config =
      [
        {:ssid, &lt;&lt;"ssid"&gt;&gt;},
        {:psk, &lt;&lt;"password"&gt;&gt;},
        {:got_ip, fn ip -&gt; :io.format('Got IP: ~p~n', [ip]) end},
        {:dhcp_hostname, &lt;&lt;"myesp32"&gt;&gt;}
      ]

    {:ok, _network_pid} = :network.start(sta: config)

    Process.sleep(4000)
  end
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>El archivo <code>mix.exs</code> con las dependencias necesarias:
.mix.exs</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-elixir hljs" data-lang="elixir">  defp deps do
    [
      {:avm_scene, git: "https://github.com/atomvm/avm_scene/"},
      {:exatomvm, git: "https://github.com/atomvm/ExAtomVM/"},
      {:atomvm_lib, git: "https://github.com/atomvm/atomvm_lib/"},
      {:mjson, git: "https://github.com/mbj4668/mjson/"}
    ]
  end</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Para el entorno de desarrollo y detalles de compilación, consulta el documento: <a href="../atomvm/devenv.html" class="xref page">Entorno de Desarrollo</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finalmente, en el archivo <code>configuration.yaml</code> de Home Assistant, se añade la configuración para el sensor REST que realizará el polling de datos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">rest:
  - resource: http://192.168.1.10:8080/temp
    scan_interval: 30
    sensor:
      - name: "ESP32 Temperature"
        value_template: "{{ value_json.temperature | replace('C', '') | float }}"
        unit_of_measurement: "°C"
        device_class: "temperature"
        state_class: "measurement"
        unique_id: "esp32_temp_sensor"
      - name: "ESP32 Humidity"
        value_template: "{{ value_json.humidity | replace('%', '') | float }}"
        unit_of_measurement: "%"
        device_class: "humidity"
        state_class: "measurement"
        unique_id: "esp32_humidity_sensor"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mqtt"><a class="anchor" href="#mqtt"></a>MQTT</h3>
<div class="paragraph">
<p>Este ejemplo describe cómo crear un programa simple en AtomVM para el ESP32 que utiliza un cliente MQTT para enviar actualizaciones de un sensor DHT11 a Home Assistant.</p>
</div>
<div class="paragraph">
<p>Para empezar, necesitamos configurar y ejecutar un broker MQTT. Utilizaremos Mosquitto en un contenedor Docker. En tu sistema host, crea un directorio para la configuración de Mosquitto y, dentro de él, crea el archivo <code>mosquitto.conf</code> con el siguiente contenido:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-conf hljs" data-lang="conf">listener 1883 0.0.0.0
allow_anonymous true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Esta configuración permite que el broker escuche en el puerto <code>1883</code> en todas las interfaces de red del host (<code>0.0.0.0</code>), y acepta conexiones sin necesidad de autenticación.</p>
</div>
<div class="paragraph">
<p>Luego, ejecuta el siguiente comando Docker. Asegúrate de ajustar la ruta del volumen (<code>-v</code>) al directorio donde creaste <code>mosquitto.conf</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker run -d \
      --name mos1 \
      --restart=unless-stopped \
      --network=host \
      -v ~/services/mosquitto/mosquitto.conf:/mosquitto/config/mosquitto.conf \
      eclipse-mosquitto</code></pre>
</div>
</div>
<div class="paragraph">
<p>Una vez que el broker Mosquitto está en funcionamiento, debes configurar Home Assistant para que se conecte a él.</p>
</div>
<div class="paragraph">
<p>Luego, se debe agregar el servicio MQTT <a href="https://www.home-assistant.io/integrations/mqtt/#broker-configuration">a través de la interfaz web de Home Assistant</a>.</p>
</div>
<div class="paragraph">
<p>Ahora, flashea el siguiente programa a tu ESP32. Este programa se conectará al broker MQTT, publicará las lecturas del DHT11 en un topic específico.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-elixir hljs" data-lang="elixir">defmodule HomeAssistantTemp do
  @dht_pin 21

  def start() do
    {:ok, dht} = :dht.start(%{pin: @dht_pin, device: :dht_11})

    setup_network()

    config = %{
      url: "mqtt://192.168.1.14:1883",
      connected_handler: &amp;handle_connected/1,
      disconnected_handler: &amp;handle_disconnected/1,
      error_handler: &amp;handle_error/2
    }

    Process.sleep(5000)
    {:ok, mqtt} = :mqtt_client.start(config)

    loop(dht, mqtt)
  end

  defp loop(dht, mqtt) do
    take_reading(dht, mqtt)
    Process.sleep(5000)
    loop(dht, mqtt)
  end

  defp take_reading(dht, mqtt) do
    case :dht.take_reading(dht) do
      {:ok, {{temp, temp_fractional}, {hum, hum_fractional}}} -&gt;
        json =
          :io_lib.format('{"temperature": ~p.~p, "humidity": ~p.~p}', [
            temp,
            temp_fractional,
            hum,
            hum_fractional
          ])
          |&gt; :lists.flatten()

        :io.format('Got reading: ~p~n', [json])

        :mqtt_client.publish(mqtt, &lt;&lt;"temp"&gt;&gt;, :erlang.list_to_binary(json))

      error -&gt;
        :io.format('Error taking reading: ~p~n', [error])
    end
  end

  defp handle_error(_mqtt, error) do
    :io.format('Got mqtt error: ~p~n', [error])
  end

  defp handle_connected(_mqtt) do
    :io.format('MQTT connected~n')
  end

  defp handle_disconnected(_mqtt) do
    :io.format('MQTT disconnected~n')
  end

  defp setup_network() do
    config =
      [
        {:ssid, &lt;&lt;"ssid"&gt;&gt;},
        {:psk, &lt;&lt;"password"&gt;&gt;},
        {:got_ip, fn ip -&gt; :io.format('Got IP: ~p~n', [ip]) end},
        {:dhcp_hostname, &lt;&lt;"myesp32"&gt;&gt;}
      ]

    {:ok, _network_pid} = :network.start(sta: config)

    Process.sleep(4000)
  end
end</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Reemplaza <code>"192.168.1.14"</code> en el código del ESP32 con la dirección IP real del host del broker.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finalmente, añade la siguiente configuración a tu archivo <code>configuration.yaml</code> de Home Assistant para crear los sensores de temperatura y humedad que recibirán los datos del ESP32.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">mqtt:
  sensor:
    - name: "Room Temperature"
      state_topic: "temp"
      unit_of_measurement: "°C"
      device_class: temperature
      value_template: "{{ value_json.temperature | round(1) }}"

    - name: "Room Humidity"
      state_topic: "temp"
      unit_of_measurement: "%"
      device_class: humidity
      value_template: "{{ value_json.humidity | round(1) }}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Después de modificar <code>configuration.yaml</code>, debes reiniciar Home Assistant para que los cambios surtan efecto.</p>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="platformio.html">PlatformIO IDE</a></span>
  <span class="next"><a href="dashboards.html">Dashboards</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>Creado por miembros de <a href="https://elixircl.github.io">Elixir Chile</a></p>
</footer>
<script id="site-script" src="../_/js/site.js" data-ui-root-path="../_"></script>
<script async src="../_/js/vendor/highlight.js"></script>
<script type="text/javascript">
  // Add custom scripts
</script>
<script src="../_/js/vendor/lunr.js"></script>
<script src="../_/js/search-ui.js" id="search-ui-script" data-site-root-path=".." data-snippet-length="100" data-stylesheet="../_/css/search.css"></script>
<script async src="../search-index.js"></script>
  </body>
</html>
